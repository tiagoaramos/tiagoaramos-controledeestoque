<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" 
			  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
			  xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" 
			  name="fechamentocaixa" 
			  language="groovy" 
			  pageWidth="595" 
			  pageHeight="842" 
			  columnWidth="535" 
			  leftMargin="20" 
			  rightMargin="20" 
			  topMargin="20" 
			  bottomMargin="20">
			  
	<parameter name="dataSolicitacao" class="java.util.Date"/>
	<parameter name="loja" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT if(tipoT IS NULL, '0', tipoT) tipoT,
       id,W
       data,
       tipo,
       codigo,
       quantidade,
       preco,
       pronome,
       total
  FROM (  SELECT data,
                 tipoT,
                 id,
                 tipo,
                 codigo,
                 quantidade,
                 preco,
                 pronome,
                 sum(total) total
            FROM ((SELECT A.saidata data,
                          '0' tipoT,
                          A.saiid id,
                          A.saitipo tipo,
                          B.sapid codigo,
                          B.sapquantidade quantidade,
                          B.sappreco preco,
                          (B.sapquantidade * B.sappreco) total,
                          C.pronome pronome
                     FROM saidamodel A, saidaprodutomodel B, produtomodel C
                    WHERE     A.saiid = B.sapsaiid
                          AND B.sapproid = C.proid
                          AND day(a.saidata) = day(curdate()))
                  UNION
                  (SELECT A.entdata data,
                          '1' tipoT,
                          A.entid id,
                          A.enttipo tipo,
                          B.enpid codigo,
                          B.enpquantidade quantidade,
                          B.enppreco preco,
                          (B.enpquantidade * B.enppreco * -1) total,
                          C.pronome pronome
                     FROM entradamodel A, entradaprodutomodel B, produtomodel C
                    WHERE     A.entid = B.enpentid
                          AND B.enpproid = C.proid
                          AND day(a.entdata) = day(curdate()))
                  UNION
                  (SELECT A.retdata data,
                          '2' tipoT,
                          A.retid id,
                          "1" tipo,
                          A.retid codigo,
                          0 quantidade,
                          (a.retvalor * -1) preco,
                          (a.retvalor * -1) total,
                          a.retdescricao pronome
                     FROM retiradamodel A where  day(a.retdata) = day(curdate()) )) view
        GROUP BY data,
                 tipoT,
                 id,
                 tipo,
                 codigo,
                 quantidade,
                 preco,
                 pronome WITH ROLLUP) view
 WHERE (    tipoT IS NOT NULL
        AND id IS NOT NULL
        AND data IS NOT NULL
        AND tipo IS NOT NULL
        AND codigo IS NOT NULL
        AND quantidade IS NOT NULL
        AND preco IS NOT NULL
        AND pronome IS NOT NULL)
       OR(    tipoT IS NULL
          AND id IS NULL
          AND data IS NULL
          AND tipo IS NULL
          AND codigo IS NULL
          AND quantidade IS NULL
          AND preco IS NULL
          AND pronome IS NULL)]]>
	</queryString>
	<field name="tipoT" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="id" class="java.lang.Long">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="data" class="java.sql.Timestamp">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="tipo" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="codigo" class="java.lang.Long">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="quantidade" class="java.lang.Long">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="preco" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="pronome" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="total" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<group name="saidata">
		<groupExpression><![CDATA[$F{data}]]></groupExpression>
		<groupHeader>
			<band height="13">
				<textField isBlankWhenNull="false" hyperlinkType="None">
					<reportElement mode="Opaque" x="0" y="0" width="555" height="13" forecolor="#006699" backcolor="#E6E6E6"/>
					<textElement>
						<font size="10" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA["   " + ($F{data} == null ? "Total do dia" : new SimpleDateFormat("H:mm:ss").format($F{data}) )]]></textFieldExpression>
				</textField>
				<line>
					<reportElement x="222" y="0" width="1" height="13"/>
				</line>
				<line>
					<reportElement x="111" y="0" width="1" height="13"/>
				</line>
				<line>
					<reportElement x="444" y="0" width="1" height="13"/>
				</line>
				<line>
					<reportElement x="333" y="0" width="1" height="13"/>
				</line>
			</band>
		</groupHeader>
		<groupFooter>
			<band/>
		</groupFooter>
	</group>
	<background>
		<band/>
	</background>
	<title>
		<band height="38">
			<frame>
				<reportElement mode="Opaque" x="-20" y="-20" width="595" height="58" backcolor="#006699"/>
				<staticText>
					<reportElement x="20" y="5" width="360" height="43" forecolor="#FFFFFF"/>
					<textElement>
						<font size="24" isBold="true"/>
					</textElement>
					<text><![CDATA[Fechamento diario]]></text>
				</staticText>
				<staticText>
					<reportElement x="395" y="13" width="180" height="20" forecolor="#FFFFFF"/>
					<textElement textAlignment="Right">
						<font size="14" isBold="false"/>
					</textElement>
					<text><![CDATA[Fechamento de caixa]]></text>
				</staticText>
				<textField pattern="EEEEE dd MMMMM yyyy" hyperlinkType="None">
					<reportElement x="395" y="33" width="180" height="13"/>
					<textElement textAlignment="Right"/>
					<textFieldExpression class="java.util.Date"><![CDATA[$P{dataSolicitacao}]]></textFieldExpression>
				</textField>
				<textField pattern="EEEEE dd MMMMM yyyy" hyperlinkType="None">
					<reportElement x="22" y="33" width="210" height="25" forecolor="#FFFFFF"/>
					<textElement textAlignment="Right">
						<font size="14"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$P{loja}]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</title>
	<pageHeader>
		<band height="13"/>
	</pageHeader>
	<columnHeader>
		<band height="13">
			<staticText>
				<reportElement mode="Opaque" x="0" y="0" width="111" height="13" forecolor="#E6E6E6" backcolor="#006699"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Tipo]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="333" y="0" width="111" height="13" forecolor="#E6E6E6" backcolor="#006699"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Quantidade]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="222" y="0" width="111" height="13" forecolor="#E6E6E6" backcolor="#006699"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Preço]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="111" y="0" width="111" height="13" forecolor="#E6E6E6" backcolor="#006699"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Produto / Desc.]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="444" y="0" width="111" height="13" forecolor="#E6E6E6" backcolor="#006699"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Total]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="13">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="0" y="0" width="111" height="13">
					<printWhenExpression><![CDATA[$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{id} != null ? 
$F{tipoT}.equals("0") ? br.com.tiagoaramos.estoque.utils.enums.TipoSaida.values()[new Integer($F{tipo}).intValue()].getDESCRICAO() : 
$F{tipoT}.equals("1") ? br.com.tiagoaramos.estoque.utils.enums.TipoEntrada.values()[new Integer($F{tipo}).intValue()].getDESCRICAO() : 
$F{tipoT}.equals("2") ? "Retirada" : 
"" : 
"Total"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="333" y="0" width="111" height="13">
					<printWhenExpression><![CDATA[$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{quantidade} == 0 ? null : $F{quantidade}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="222" y="0" width="111" height="13">
					<printWhenExpression><![CDATA[$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{preco}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="111" y="0" width="111" height="13">
					<printWhenExpression><![CDATA[$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{pronome}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="444" y="0" width="111" height="13" backcolor="#FFFFFF">
					<printWhenExpression><![CDATA[$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{total}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="0" y="0" width="111" height="13" backcolor="#FF9999">
					<printWhenExpression><![CDATA[!$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{id} != null ? 
$F{tipoT}.equals("0") ? br.com.tiagoaramos.estoque.utils.enums.TipoSaida.values()[new Integer($F{tipo}).intValue()].getDESCRICAO() : 
$F{tipoT}.equals("1") ? br.com.tiagoaramos.estoque.utils.enums.TipoEntrada.values()[new Integer($F{tipo}).intValue()].getDESCRICAO() : 
$F{tipoT}.equals("2") ? "Retirada" : 
"" : 
"Total"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="333" y="0" width="111" height="13" backcolor="#FF9999">
					<printWhenExpression><![CDATA[!$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{quantidade} == 0 ? null : $F{quantidade}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="222" y="0" width="111" height="13" backcolor="#FF9999">
					<printWhenExpression><![CDATA[!$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{preco}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="111" y="0" width="111" height="13" backcolor="#FF9999">
					<printWhenExpression><![CDATA[!$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{pronome}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" hyperlinkType="None">
				<reportElement mode="Opaque" x="444" y="0" width="111" height="13" backcolor="#FF9999">
					<printWhenExpression><![CDATA[!$F{tipoT}.equals("0")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{total}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="222" y="0" width="1" height="13"/>
			</line>
			<line>
				<reportElement x="111" y="0" width="1" height="13"/>
			</line>
			<line>
				<reportElement x="333" y="0" width="1" height="13"/>
			</line>
			<line>
				<reportElement x="444" y="0" width="1" height="13"/>
			</line>
		</band>
	</detail>
	<columnFooter>
		<band/>
	</columnFooter>
	<pageFooter>
		<band height="13">
			<textField hyperlinkType="None">
				<reportElement mode="Opaque" x="0" y="0" width="515" height="13" backcolor="#E6E6E6"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.lang.String"><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
			<textField hyperlinkType="None">
				<reportElement mode="Opaque" x="515" y="0" width="40" height="13" backcolor="#E6E6E6"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField pattern="EEEEE dd MMMMM yyyy" hyperlinkType="None">
				<reportElement x="0" y="0" width="299" height="13"/>
				<textElement/>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{dataSolicitacao}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band/>
	</summary>
</jasperReport>
